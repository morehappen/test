{"version":3,"sources":["../../es6/common/common-approve.es6"],"names":[],"mappings":"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","file":"common-approve.js","sourcesContent":["/***** author:zhanghao 2018-4-20 O(∩_∩)O~ *****/\n'use strict'\n\nclass Approve {\n\n\tconstructor () {\n\n\t}\n\n\t// 初始化审批信息\n\n\tinitApprove () {\n\t\tlet data = $.extend(true,[],this.data.data),\n\t\t\tlength = data.length;\n\t\tif(length <= 0){\n\t\t\t$('[data-approve=\"container\"]').hide();\n\t\t\t$(\".sp-rule\").html(`<input type=\"hidden\" name=\"\" value=\"\">`); //没设置审批规则，防止后台空指针\n\t\t\treturn;\n\t\t}\n\t\tthis.viewApprovePerson(this.viewApproveRule(data)); // 视图审批人 ，内层为视图审批规则\n\t\treturn this;\n\t}\n\n\t// 获取审批信息\n\t/*\n\t* \tpara list\n\t* \tpara(object):\n\t* \t\tempids: 员工id 以-分割 如：90-09-\n\t* \t\tmodule: 模块类型， 值的选择列表：gjjp | gnjp | gptp | gpgq | gnhcp | hcptp | gnjd | gnyc\n\t* \t\twebeiflage: 0 | 1 0不违背，1违背 empids=&module=gnjd&webeiflage=0'\n\t* */\n\tgetApprove (para) {\n\t\t$.ajax({\n\t\t\ttype: 'POST',\n\t\t\turl: `/shopping/approve?empids=${para.empids}&module=${para.module}&webeiflage=${para.webeiflage}`,\n\t\t\tdataType: 'json',\n\t\t\tsuccess: data => {\n\t\t\t\tif(data.status === 200) {\n\t\t\t\t\t!Approve.prototype.data ? this.eventApprove : \"\";\n\t\t\t\t\tApprove.prototype.data = data; // 存储审批信息数据\n\t\t\t\t\tthis.initApprove(); // 初始化审批信息\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlayer.msg(data.msg);\n\t\t\t},\n\t\t\terror: error => {\n\t\t\t\tlayer.msg(error.status === 0 ? \"确保您的网络畅通，请重试\" : \"服务器异常，请重试\");\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t}\n\n\t// 视图审批规则\n\t/*\n\t* \tpara:\n\t* \t\teRule:审批规则数据\n\t* */\n\tviewApproveRule (data) {\n\t\tlet rule = data,\n\t\t\tlist = '';\n\t\tfor(let i = 0; i < rule.length; i++){\n\t\t\tlet eRule = rule[i];\n\t\t\tlist += `<option value=\"${eRule.id}\">${eRule.name}</option>`;\n\t\t}\n\t\t$('[data-approve=\"approveRule\"]').html(`<select class=\"_dropDown_ hide\" data-select=\"approveRule\" name=\"\" data-value=\"${rule[0].id}\">${list}</select>`);\n\t\t(new SelectMain()).creatSelect($('[data-select=\"approveRule\"]'));\n\t\treturn rule[0].id; // 返回当前选中的审批规则id\n\t}\n\t//展示审批人\n\t/*\n\t*\tpara list\n\t*\t\tid: 选中审批规则的id\n\t* */\n\tviewApprovePerson (id) {\n\t\tlet eid = parseInt(id),\n\t\t\tePerson = $.extend(true,[],this.data.data),\n\t\t\tselectData = null,\n\t\t\tshenpirens = null,\n\t\t\tlevel = [],\n\t\t\tlist = '',\n\t\t\tcompare = level => (a, b) => b[level] - a[level];\n\t\t$('[data-approve=\"approvePerson\"]').html(\"\");\n\t\tfor(let i = 0; i < ePerson.length; i++){\n\t\t\tif(ePerson[i].id === eid){\n\t\t\t\tselectData = ePerson[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tshenpirens = selectData.shenpirens.sort(compare);\n\t\tfor(let i = 0; i < shenpirens.length; i++){\n\t\t\tlet level_ = shenpirens[i].level;\n\t\t\tif(level.length === 0){\n\t\t\t\tlevel.push(level_);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(level_ !== level[level.length-1]){\n\t\t\t\tlevel.push(level_);\n\t\t\t}\n\t\t}\n\t\tfor(let i = 0; i < level.length; i++){\n\t\t\tlet level_ = level[i];\n\t\t\tlist += `<div class=\"clear e-sp\"><div class=\"float-left e-sp-t\">${level_}级审批</div>`;\n\t\t\tfor(let i =0; i< shenpirens.length; i++){\n\t\t\t\tlet eAp = shenpirens[i];\n\t\t\t\tif(level_ === eAp.level){\n\t\t\t\t\tlist += `<div class=\"float-left sp-person\" data-eapid=\"${eAp.id}\">${eAp.name}</div>`;\n\t\t\t\t\tshenpirens.splice(i,1);\n\t\t\t\t\t--i;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlist += `</div>`;\n\t\t}\n\n\t\t$('[data-approve=\"approvePerson\"]').html(list);\n\t\t$('[data-approve=\"container\"]').show();\n\t\treturn;\n\t}\n\n\teventApprove () {\n\t\t// 切换审批规则\n\t\t$(\"body\").on(\"click\",\".drop_option li\", event => {\n\t\t\tlet this_ = $(event.target),\n\t\t\t\tselect = this_.parents('.drop').find('select'),\n\t\t\t\tid = select.val();\n\t\t\tif(select.is('[data-select=\"approveRule\"]')){\n\t\t\t\tthis.viewApprovePerson(id);\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t}\n\n}\n\n\n\n\n\n\n"]}